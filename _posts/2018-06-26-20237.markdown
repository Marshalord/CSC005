---
layout: post
title: Windows Settings Shortcuts Can Be Abused for Code Execution on Windows 10
date: 2018-06-26 19:15:22
tourl: https://www.bleepingcomputer.com/news/security/windows-settings-shortcuts-can-be-abused-for-code-execution-on-windows-10/
tags: [attack]
---
A new file type format added in Windows 10 can be abused for running malicious code on users' computers, according to Matt Nelson, a security researcher for SpecterOps.The file type is ".SettingContent-ms", a file format introduced in Windows 10 in 2015. This file format is used to create shortcuts to Windows 10 settings pages, which Microsoft created as an alternative to classic Control Panel options.All SettingContent-ms files are nothing more than XML documents, which contain aDeepLinktag that specifies the on-disk location of the Windows 10 setting page that it will open when users double-click  shortcuts.But earlier this month, Nelson discovered that he could replace this DeepLink tag with any other executables from the local system, including links to binaries such as cmd.exe or PowerShell.exe, two apps that allow shell command execution.Further, Nelson discovered that he could chain two binary paths and have them executed one after the other. This means that attackers can create boobytrapped SettingContent-ms shortcuts that run malicious code in the background and then show the intended Windows setting page, like nothing ever happened.Tricking users to open such files appears to be an easy task as well. Nelson says he hosted a SettingContent-ms shortcut on a web server, and he was able to download and run it without Windows 10 or Windows Defender alerting the user at all."Yikes!! When this file comes straight from the internet, it executes as soon as the user clicks 'open'," Nelson wrote in his research. "For one reason or another, the file still executes without any notification or warning to the user."Nelson recorded a video of him opening a SettingContent-ms shortcut he downloaded from a remote server.But despite its web-based execution vector, most users will generally be wary of opening a file with an extension of SettingContent-ms, which many have not heard of before.Nelson says this isn't a big problem, as malware authors can also embed a SettingContent-ms shortcut inside Office documents with the help of an Office feature named  Object Linking and Embedding (OLE).This feature allows Office users to embed other files in Office documents. It was intended to improve Office's appeal to users, but in the past few decades, it has also been one of the simplest methods of running malicious code on users' PCs.Microsoft has counteracted this trend by This means that malware authors can reliably use SettingContent-ms file types Office documents to execute malicious operations on users' systems.But that's not all. Nelson also says SettingContent-ms also bypasses a Windows 10 security feature named Attack Surface Reduction (ASR).ASR is a collection of various security rules. They are optional in Windows 10 and are disabled by default. One of the many ASR rules that users can enable can prevent Office documents from starting child processes, a technique used by malware to spread from an Office OLE object to their own process.On large enterprise networks, system administrators often Nelson says that SettingContent-ms files can bypass this ASR rule that prevents Office from spawning child processes. The trick is to chain the SettingContent-ms DeepLink to start with an Office app that's whitelisted and allowed to start child processes, and then continue from there by running the malicious operations afterward.By using this trick, malware authors can achieve code execution on even the most hardened Windows 10 PCs.Nelson contacted Microsoft, but the OS maker did not consider this a vulnerability in the OS. While this won't be fixed in an urgent Patch Tuesday security update, it is highly likely that SettingContent-ms files will end up on the OLE file format blacklist pretty soon.Nelson has published some defenses against the malicious use of SettingContent-ms files in 