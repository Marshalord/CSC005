---
layout: post
title: Obfuscated Coinhive shortlink reveals larger mining operation July 3, 2018 - A web miner injected into compromised sites is just the tip of the iceberg for an infrastructure hosting malicious Windows and Linux coin miners.CONTINUE READING
date: 2018-07-04 00:00:11
tourl: https://blog.malwarebytes.com/threat-analysis/2018/07/obfuscated-coinhive-shortlink-reveals-larger-mining-operation/
tags: [Malware]
---
During the past several months, in-browser mining has continued to affect a large number of websites, predominantly relying on Coinhives infamous API. We documented several campaigns on this blog, in particular In the past weeks, our crawlers have catalogued several hundred sites using a variety of CMS all injected with the same obfuscated code that uses Coinhives shortlink to perform silent As part of our regular crawls, we look for known redirects to sites of interest and lately, most have been related to Coinhive domains. We detected hundreds of new domains, all legitimate websites that were injected with a blurb of hexadecimal code. Once decoded, it shows as an invisible iframe (1×1 pixel) to The cnhv[.]co domain name is used for what Coinhive calls In Figure 3 where we made the iframe visible by by changing its dimensions, to show that rather than wait for a few seconds before being redirected, users will unknowingly be mining for as long as they stay on the page. Indeed, while Coinhives default setting is set to 1024 hashes, this one requires 3,712,000 before loading the destination URL.Querying Several sites have been injected with The URI pattern used for the redirections can be identified by the following regular expression:Looking at those URIs again, we can note the presence of certain keywords that appear to be Search Engine Optimization (SEO) related, for instance:We confirmed that indeed some Google or Bing searches showed us results that included the list of compromised sites that are acting as doorways, usually to a traffic distribution system or redirector (5.45.79[.]15). In this case, the doorways are used to trick people into downloading Note how the server at 5.45.79[.]15 is performing the redirection to another hacked sited (Upon execution, this executable will unpack the following three binaries:The batch script adds persistence by setting a registry entry, kills certain processes (possible miners already running), and starts mining by launching:The fake download binaries are based on the same code from a miner, unsurprisingly, hosted at A comment left on this Once it has retrieved the ELF binary, it runs it, using the following command in order to begin mining:Because the miners are connecting to private pools (and likely via proxy) without using a wallet address, we cannot assess how much money the perpetrators have generated with this scheme.In fact, the server at 5.45.79[.]15 also has its own The XMRig version of the miner had a public stats page indicating that there were close to 500 infected machines that had participated in the mining activity. For the CNRig version, we werent able to find any such stat, although the number of hacked servers was much higher.The interest surrounding cryptocurrencies has drastically changed the malware landscape with criminals hoping to get a piece of the action. As such, a growing number of websites are being compromised both client- and server-side to distribute and run coin miners.In this campaign, we see infrastructure used to push an XMRig miner onto users by tricking them into downloading files they were searching for online. In the meantime, hacked servers are instructed to download and run a Linux miner, generating profits for the perpetrators but incurring costs for their owners. Finally, it seems only fitting to see an abuse of Coinhives shortlinks to perform in-browser mining.String for obfuscated cnvh[.]co injectionCoinhive shortlinkCoinhive site keyRegex for compromised sites redirectionRedirection serverWindows miner dropperLinux miner